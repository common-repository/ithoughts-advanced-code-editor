/**
 * @file Simple AJAX Form
 * @description jQuery extension to make forms AJAX enabled. Mainly used in WordPress projects
 *
 * @author Gerkin, tcbarrett
 * @copyright 2016 
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package iThoughts-toolbox
 *
 */
!function(t){"use strict";var e=t.$;e.fn.extend({simpleAjaxForm:function(t){var a={validate:!1},r=e.extend(a,t);return this.each(function(){var t=e(this),a=e.extend({target:t.data("target"),callback:t.data("callback")},r);a.target&&e("#"+a.target).length&&e("#"+a.target).html("").hide(),t.find('button[name="actionB"]').click(function(){t.find('[name="action"]').val(this.getAttribute("value"))});var n=this.getAttribute("post_text")?this.getAttribute("post_text"):"Updating, please wait...";t.ajaxForm({beforeSubmit:function(t,r,o){return a.target&&e("#"+a.target).length&&e("#"+a.target).html("<p>"+n+"</p>").removeClass().addClass("clear updating").fadeTo(100,1),!0},error:function(){e("#"+a.target).removeClass().addClass("clear notice notice-error").html("<p>Form submission failed.</p>")},success:function(r,n,o,i){if("undefined"==typeof i&&(i=o),"undefined"==typeof i)return e("#"+a.target).removeClass().addClass("clear notice notice-error").html(s.text),void t.append('<div class="error"><p>Cannot handle response properly</p></div>');try{var s;if("String"==r.constructor.name)s=JSON.parse(r);else{if("Object"!=r.constructor.name)throw"Unhandled type "+typeof r;s=r}"0"!=s&&s?("undefined"!=typeof s.success&&null!=s.success&&"undefined"!=typeof s.data&&null!=s.data&&(s.data.valid=s.success,s=s.data),s.valid?(s.reload&&(window.location.href=window.location.href+"&json-res-txt="+window.encodeURI(s.text)),a.target&&e("#"+a.target).length&&e("#"+a.target).removeClass().addClass("clear notice notice-success").html(s.text),s.redirect&&(s.text?setTimeout(function(){window.location.href=s.redirect},2500):window.location.href=s.redirect)):a.target&&e("#"+a.target).length&&e("#"+a.target).removeClass().addClass("clear notice notice-error").html(s.text),"function"==typeof t[0].simple_ajax_callback&&t[0].simple_ajax_callback(s),"function"==typeof a.callback&&a.callback(s)):e("#"+a.target).removeClass().addClass("clear notice notice-warning").html("<p>Server did not respond anything</p>")}catch(c){e("#"+a.target).removeClass().addClass("clear notice notice-error").html("<p>Invalid server response</p>")}}})})}}),t.$d.ready(function(){e(".simpleajaxform").simpleAjaxForm()})}(Ithoughts.v3);